[
  {
    "objectID": "linearregression.html",
    "href": "linearregression.html",
    "title": "linear regression",
    "section": "",
    "text": "一般线性回归\n\n&gt; library(readxl)\n&gt; joined_data &lt;- read_excel(\"D:\\\\Rstudio\\\\Rmyfile\\\\Flights\\\\EDA\\\\joined_data.xlsx\")\n\n\n&gt; D &lt;- lm(arr_delay~month+day+hour+dep_time+sched_dep_time+arr_time+carrier+flight+origin+dest+air_time+distance+temp+dewp+humid+wind_dir+wind_speed+pressure+visib,data = joined_data) \n&gt; summary(D)\n   \n   Call:\n   lm(formula = arr_delay ~ month + day + hour + dep_time + sched_dep_time + \n       arr_time + carrier + flight + origin + dest + air_time + \n       distance + temp + dewp + humid + wind_dir + wind_speed + \n       pressure + visib, data = joined_data)\n   \n   Residuals:\n       Min      1Q  Median      3Q     Max \n   -119.98  -18.81   -7.22    7.12 1283.34 \n   \n   Coefficients:\n                    Estimate Std. Error t value Pr(&gt;|t|)    \n   (Intercept)     3.601e+02  3.373e+01  10.676  &lt; 2e-16 ***\n   month          -2.750e-01  2.200e-02 -12.500  &lt; 2e-16 ***\n   day             7.307e-02  8.059e-03   9.067  &lt; 2e-16 ***\n   hour            4.103e+00  3.817e-01  10.751  &lt; 2e-16 ***\n   dep_time        7.860e-02  5.367e-04 146.451  &lt; 2e-16 ***\n   sched_dep_time -9.199e-02  3.876e-03 -23.734  &lt; 2e-16 ***\n   arr_time       -1.625e-02  1.915e-04 -84.849  &lt; 2e-16 ***\n   carrierAA      -4.968e+00  5.796e-01  -8.571  &lt; 2e-16 ***\n   carrierAS      -1.302e+01  1.800e+00  -7.237 4.58e-13 ***\n   carrierB6       1.633e+00  5.398e-01   3.024 0.002494 ** \n   carrierDL      -5.109e+00  5.048e-01 -10.120  &lt; 2e-16 ***\n   carrierEV       8.767e+00  4.460e-01  19.655  &lt; 2e-16 ***\n   carrierF9       8.411e+00  1.725e+00   4.875 1.09e-06 ***\n   carrierFL       4.765e+00  1.054e+00   4.523 6.11e-06 ***\n   carrierHA      -1.269e+01  3.137e+00  -4.045 5.24e-05 ***\n   carrierMQ       4.915e+00  4.484e-01  10.960  &lt; 2e-16 ***\n   carrierOO       2.000e+00  7.258e+00   0.276 0.782874    \n   carrierUA      -3.408e+00  5.639e-01  -6.043 1.51e-09 ***\n   carrierUS      -2.314e+00  6.065e-01  -3.814 0.000137 ***\n   carrierVX      -5.070e+00  8.238e-01  -6.154 7.56e-10 ***\n   carrierWN      -5.860e-02  7.146e-01  -0.082 0.934645    \n   carrierYV       4.390e+00  1.784e+00   2.460 0.013878 *  \n   flight         -8.266e-04  1.225e-04  -6.745 1.53e-11 ***\n   originJFK      -2.125e+00  3.334e-01  -6.374 1.84e-10 ***\n   originLGA       6.214e-01  3.287e-01   1.890 0.058708 .  \n   destACK        -1.152e+02  2.846e+01  -4.048 5.18e-05 ***\n   destALB        -1.149e+02  2.916e+01  -3.942 8.10e-05 ***\n   destANC         1.527e+02  3.020e+01   5.056 4.28e-07 ***\n   destATL        -6.041e+01  1.868e+01  -3.233 0.001223 ** \n   destAUS        -1.341e+01  5.947e+00  -2.255 0.024103 *  \n   destAVL        -8.196e+01  2.164e+01  -3.788 0.000152 ***\n   destBDL        -1.193e+02  2.963e+01  -4.026 5.67e-05 ***\n   destBGR        -9.881e+01  2.534e+01  -3.899 9.67e-05 ***\n   destBHM        -6.192e+01  1.703e+01  -3.635 0.000278 ***\n   destBNA        -6.877e+01  1.864e+01  -3.690 0.000224 ***\n   destBOS        -1.129e+02  2.841e+01  -3.975 7.05e-05 ***\n   destBQN         1.837e+01  5.098e+00   3.603 0.000315 ***\n   destBTV        -1.058e+02  2.714e+01  -3.897 9.75e-05 ***\n   destBUF        -1.067e+02  2.662e+01  -4.008 6.12e-05 ***\n   destBUR         5.646e+01  1.155e+01   4.887 1.02e-06 ***\n   destBWI        -1.115e+02  2.865e+01  -3.894 9.88e-05 ***\n   destBZN         3.096e+01  7.405e+00   4.181 2.90e-05 ***\n   destCAE        -5.847e+01  2.152e+01  -2.717 0.006582 ** \n   destCAK        -9.116e+01  2.503e+01  -3.642 0.000270 ***\n   destCHO        -1.121e+02  2.713e+01  -4.130 3.62e-05 ***\n   destCHS        -7.545e+01  2.077e+01  -3.633 0.000280 ***\n   destCLE        -9.398e+01  2.458e+01  -3.824 0.000131 ***\n   destCLT        -8.268e+01  2.238e+01  -3.694 0.000221 ***\n   destCMH        -9.011e+01  2.353e+01  -3.829 0.000129 ***\n   destCRW        -9.452e+01  2.439e+01  -3.875 0.000107 ***\n   destCVG        -8.405e+01  2.173e+01  -3.869 0.000109 ***\n   destDAY        -8.643e+01  2.238e+01  -3.862 0.000113 ***\n   destDCA        -1.107e+02  2.808e+01  -3.941 8.13e-05 ***\n   destDEN        -1.541e+00  4.424e+00  -0.348 0.727569    \n   destDFW        -2.374e+01  8.050e+00  -2.949 0.003190 ** \n   destDSM        -4.923e+01  1.416e+01  -3.477 0.000507 ***\n   destDTW        -9.158e+01  2.313e+01  -3.959 7.52e-05 ***\n   destEGE         9.357e-01  4.040e+00   0.232 0.816854    \n   destEYW        -1.270e+01  1.520e+01  -0.836 0.403323    \n   destFLL        -4.006e+01  1.331e+01  -3.009 0.002622 ** \n   destGRR        -7.524e+01  2.117e+01  -3.554 0.000380 ***\n   destGSO        -8.959e+01  2.388e+01  -3.751 0.000176 ***\n   destGSP        -7.814e+01  2.135e+01  -3.660 0.000253 ***\n   destHDN         1.154e+01  1.124e+01   1.027 0.304540    \n   destHNL         2.982e+02  5.475e+01   5.447 5.13e-08 ***\n   destHOU        -2.064e+01  7.437e+00  -2.775 0.005527 ** \n   destIAD        -1.084e+02  2.785e+01  -3.891 9.99e-05 ***\n   destIAH        -1.649e+01  7.619e+00  -2.164 0.030440 *  \n   destILM        -1.000e+02  2.346e+01  -4.263 2.02e-05 ***\n   destIND        -7.761e+01  2.041e+01  -3.803 0.000143 ***\n   destJAC         4.715e+01  8.837e+00   5.336 9.52e-08 ***\n   destJAX        -6.245e+01  1.748e+01  -3.573 0.000353 ***\n   destLAS         4.572e+01  7.712e+00   5.929 3.06e-09 ***\n   destLAX         6.524e+01  1.150e+01   5.674 1.40e-08 ***\n   destLEX        -9.271e+01  4.324e+01  -2.144 0.032048 *  \n   destLGB         5.564e+01  1.148e+01   4.849 1.24e-06 ***\n   destMCI        -4.491e+01  1.278e+01  -3.514 0.000441 ***\n   destMCO        -5.046e+01  1.547e+01  -3.261 0.001109 ** \n   destMDW        -7.010e+01  1.929e+01  -3.633 0.000280 ***\n   destMEM        -5.513e+01  1.526e+01  -3.612 0.000304 ***\n   destMHT        -1.086e+02  2.804e+01  -3.874 0.000107 ***\n   destMIA        -3.704e+01  1.297e+01  -2.857 0.004283 ** \n   destMKE        -7.012e+01  1.906e+01  -3.678 0.000235 ***\n   destMSN        -6.242e+01  1.786e+01  -3.495 0.000475 ***\n   destMSP        -4.960e+01  1.421e+01  -3.490 0.000483 ***\n   destMSY        -3.695e+01  1.149e+01  -3.215 0.001303 ** \n   destMTJ         1.348e+01  1.073e+01   1.256 0.208951    \n   destMVY        -1.234e+02  2.894e+01  -4.264 2.01e-05 ***\n   destMYR        -8.583e+01  2.270e+01  -3.782 0.000156 ***\n   destOAK         6.412e+01  1.344e+01   4.769 1.85e-06 ***\n   destOKC        -2.668e+01  9.122e+00  -2.925 0.003448 ** \n   destOMA        -4.332e+01  1.213e+01  -3.570 0.000357 ***\n   destORD        -7.392e+01  1.915e+01  -3.859 0.000114 ***\n   destORF        -1.047e+02  2.675e+01  -3.915 9.06e-05 ***\n   destPBI        -3.979e+01  1.401e+01  -2.840 0.004516 ** \n   destPDX         5.575e+01  1.118e+01   4.986 6.16e-07 ***\n   destPHL        -1.176e+02  3.016e+01  -3.898 9.69e-05 ***\n   destPHX         3.759e+01  6.205e+00   6.058 1.38e-09 ***\n   destPIT        -1.033e+02  2.599e+01  -3.974 7.06e-05 ***\n   destPSE         4.088e+01  4.909e+00   8.328  &lt; 2e-16 ***\n   destPSP         4.645e+01  1.366e+01   3.400 0.000673 ***\n   destPVD        -1.099e+02  2.888e+01  -3.807 0.000141 ***\n   destPWM        -1.034e+02  2.697e+01  -3.836 0.000125 ***\n   destRDU        -9.291e+01  2.439e+01  -3.809 0.000140 ***\n   destRIC        -1.023e+02  2.679e+01  -3.819 0.000134 ***\n   destROC        -1.068e+02  2.728e+01  -3.917 8.98e-05 ***\n   destRSW        -4.587e+01  1.326e+01  -3.460 0.000541 ***\n   destSAN         6.361e+01  1.101e+01   5.776 7.68e-09 ***\n   destSAT        -7.365e+00  5.145e+00  -1.432 0.152280    \n   destSAV        -6.928e+01  1.940e+01  -3.571 0.000355 ***\n   destSBN        -8.285e+01  2.447e+01  -3.386 0.000710 ***\n   destSDF        -8.337e+01  2.051e+01  -4.065 4.80e-05 ***\n   destSEA         5.426e+01  1.062e+01   5.109 3.24e-07 ***\n   destSFO         7.498e+01  1.337e+01   5.607 2.06e-08 ***\n   destSJC         5.967e+01  1.332e+01   4.481 7.44e-06 ***\n   destSJU         1.874e+01  4.664e+00   4.018 5.86e-05 ***\n   destSLC         2.273e+01  3.870e+00   5.875 4.24e-09 ***\n   destSMF         6.440e+01  1.254e+01   5.135 2.83e-07 ***\n   destSNA         5.123e+01  1.114e+01   4.598 4.26e-06 ***\n   destSRQ        -4.547e+01  1.386e+01  -3.280 0.001037 ** \n   destSTL        -6.097e+01  1.652e+01  -3.691 0.000223 ***\n   destSTT         2.491e+01  4.578e+00   5.441 5.31e-08 ***\n   destSYR        -1.125e+02  2.823e+01  -3.985 6.76e-05 ***\n   destTPA        -4.600e+01  1.444e+01  -3.185 0.001447 ** \n   destTUL        -3.271e+01  1.093e+01  -2.993 0.002763 ** \n   destTVC        -7.602e+01  2.089e+01  -3.640 0.000273 ***\n   destTYS        -7.375e+01  2.074e+01  -3.557 0.000376 ***\n   destXNA        -4.556e+01  1.215e+01  -3.749 0.000178 ***\n   air_time        9.137e-01  6.594e-03 138.576  &lt; 2e-16 ***\n   distance       -1.938e-01  1.739e-02 -11.145  &lt; 2e-16 ***\n   temp            2.818e-01  4.361e-02   6.462 1.03e-10 ***\n   dewp           -2.075e-03  4.699e-02  -0.044 0.964775    \n   humid           2.238e-01  2.409e-02   9.289  &lt; 2e-16 ***\n   wind_dir       -9.334e-03  7.868e-04 -11.864  &lt; 2e-16 ***\n   wind_speed      4.974e-01  1.499e-02  33.174  &lt; 2e-16 ***\n   pressure       -2.708e-01  1.106e-02 -24.471  &lt; 2e-16 ***\n   visib          -1.162e+00  6.150e-02 -18.890  &lt; 2e-16 ***\n   ---\n   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n   \n   Residual standard error: 37.57 on 284413 degrees of freedom\n   Multiple R-squared:  0.1996, Adjusted R-squared:  0.1992 \n   F-statistic: 521.4 on 136 and 284413 DF,  p-value: &lt; 2.2e-16\n\n将几乎所有的变量都放进去之后，发现拟合效果并不好，仅能解释20%的延迟到达的变异。\n同时，我们发现，在全模型下，上面提到的两个正相关的变量temp与dewp的P值，temp十分显著，dewp的P=0.96》0.05。因此我们分别对两个变量做一个单变量的线性回归做一下验证。\n\n&gt; lm(data = joined_data,arr_delay~temp) |&gt;summary()\n   \n   Call:\n   lm(formula = arr_delay ~ temp, data = joined_data)\n   \n   Residuals:\n       Min      1Q  Median      3Q     Max \n    -91.50  -22.14  -10.27    7.14 1268.50 \n   \n   Coefficients:\n               Estimate Std. Error t value Pr(&gt;|t|)    \n   (Intercept) -1.20669    0.25970  -4.647 3.38e-06 ***\n   temp         0.10475    0.00435  24.080  &lt; 2e-16 ***\n   ---\n   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n   \n   Residual standard error: 41.94 on 284548 degrees of freedom\n   Multiple R-squared:  0.002034,   Adjusted R-squared:  0.00203 \n   F-statistic: 579.8 on 1 and 284548 DF,  p-value: &lt; 2.2e-16\n&gt; lm(data = joined_data,arr_delay~dewp) |&gt;summary()\n   \n   Call:\n   lm(formula = arr_delay ~ dewp, data = joined_data)\n   \n   Residuals:\n       Min      1Q  Median      3Q     Max \n    -93.52  -22.19  -10.06    7.44 1267.78 \n   \n   Coefficients:\n               Estimate Std. Error t value Pr(&gt;|t|)    \n   (Intercept) -1.89496    0.18056  -10.49   &lt;2e-16 ***\n   dewp         0.16515    0.00404   40.88   &lt;2e-16 ***\n   ---\n   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n   \n   Residual standard error: 41.86 on 284548 degrees of freedom\n   Multiple R-squared:  0.005839,   Adjusted R-squared:  0.005836 \n   F-statistic:  1671 on 1 and 284548 DF,  p-value: &lt; 2.2e-16\n\n忽略R2的值，我们发现,两个模型均显著，但我们上面全模型中，dewp并不显著。因此我们认为，在对arr_delay的贡献上，dewp可能会抢temp的功劳而认为其与航班推迟有关，而其实是因为dewp与temp有关所以才在单个模型中显著。当二者同时出现在模型中时，真正起作用的变量就体现出来了。证实了我们课上的结论。因此之后筛选模型时，将会优先考虑使用temp而不是dewp。\n\n\n观察变量之间的相关性\n将关心的变量中数值类型和字符类型分开处理\n\n&gt; numdata &lt;- joined_data[,c(4:9,15:17,20:26)]\n&gt; strdata &lt;- joined_data[,c(2,3,10,13,14)]\n\n对于数值类型变量做相关性图\n\n&gt; library(corrplot)\n&gt; corrplot(corr = cor(numdata),type = 'upper')\n\n\n\n\n\n\n\n\n发现，arr_delay与dep_delay之间有很强的相关性，因此在回归方程中引入dep_delay变量。解释为：离开延迟，大概率到达也会延迟。\n\n\n根据实际情况回归\n从乘客角度出发筛选变量。已知，出发月份2，日期3，预计离开时间5，离开延迟9，预计到达时间8，航空公司10，出发地13，目的地14（回归不显著），距离16，空气质量数据20：27（wind_gust由于缺失数据太多，不纳入拟合方程中）\n\n&gt; Care_data &lt;- joined_data[,c(2,3,5,6,8,9,10,13,14,16,17,20:27)]\n\n\n&gt; lm(arr_delay~.-day-dewp,data = Care_data) |&gt;summary()\n   \n   Call:\n   lm(formula = arr_delay ~ . - day - dewp, data = Care_data)\n   \n   Residuals:\n       Min      1Q  Median      3Q     Max \n   -75.686 -10.475  -1.816   8.247 190.253 \n   \n   Coefficients:\n                    Estimate Std. Error  t value Pr(&gt;|t|)    \n   (Intercept)     1.781e+02  1.514e+01   11.765  &lt; 2e-16 ***\n   month           1.239e-01  9.914e-03   12.502  &lt; 2e-16 ***\n   sched_dep_time -3.382e-03  1.718e-03   -1.969 0.048998 *  \n   dep_delay       1.012e+00  8.776e-04 1152.781  &lt; 2e-16 ***\n   sched_arr_time -1.643e-04  1.129e-04   -1.456 0.145416    \n   carrierAA       3.172e+00  2.172e-01   14.605  &lt; 2e-16 ***\n   carrierAS      -3.321e+00  7.908e-01   -4.199 2.68e-05 ***\n   carrierB6       7.063e+00  1.874e-01   37.682  &lt; 2e-16 ***\n   carrierDL       1.998e+00  1.935e-01   10.330  &lt; 2e-16 ***\n   carrierEV       4.128e+00  1.948e-01   21.189  &lt; 2e-16 ***\n   carrierF9       1.034e+01  7.630e-01   13.551  &lt; 2e-16 ***\n   carrierFL       7.747e+00  4.429e-01   17.491  &lt; 2e-16 ***\n   carrierHA       1.968e+00  1.409e+00    1.396 0.162664    \n   carrierMQ       9.351e+00  2.020e-01   46.293  &lt; 2e-16 ***\n   carrierOO       8.430e+00  3.273e+00    2.576 0.009996 ** \n   carrierUA       1.763e+00  2.143e-01    8.227  &lt; 2e-16 ***\n   carrierUS       7.551e+00  2.474e-01   30.518  &lt; 2e-16 ***\n   carrierVX       9.293e-01  3.335e-01    2.786 0.005330 ** \n   carrierWN      -5.958e-01  3.018e-01   -1.974 0.048359 *  \n   carrierYV       5.313e+00  8.030e-01    6.617 3.67e-11 ***\n   originJFK      -1.681e+00  1.502e-01  -11.194  &lt; 2e-16 ***\n   originLGA      -4.164e-01  1.474e-01   -2.825 0.004731 ** \n   destACK        -1.656e+01  1.282e+01   -1.292 0.196419    \n   destALB        -2.436e+01  1.314e+01   -1.854 0.063696 .  \n   destANC         2.494e+01  1.361e+01    1.833 0.066855 .  \n   destATL        -6.285e+00  8.418e+00   -0.747 0.455273    \n   destAUS         6.779e-01  2.680e+00    0.253 0.800292    \n   destAVL        -7.666e+00  9.750e+00   -0.786 0.431729    \n   destBDL        -2.578e+01  1.335e+01   -1.932 0.053422 .  \n   destBGR        -2.175e+01  1.142e+01   -1.905 0.056800 .  \n   destBHM        -1.508e+01  7.675e+00   -1.964 0.049478 *  \n   destBNA        -1.031e+01  8.396e+00   -1.227 0.219656    \n   destBOS        -2.051e+01  1.280e+01   -1.602 0.109109    \n   destBQN         3.254e+00  2.300e+00    1.415 0.157168    \n   destBTV        -1.874e+01  1.223e+01   -1.533 0.125396    \n   destBUF        -1.711e+01  1.200e+01   -1.426 0.153780    \n   destBUR         1.326e+01  5.207e+00    2.546 0.010885 *  \n   destBWI        -1.815e+01  1.291e+01   -1.406 0.159695    \n   destBZN         1.214e+01  3.340e+00    3.634 0.000280 ***\n   destCAE         9.878e-01  9.695e+00    0.102 0.918851    \n   destCAK        -1.531e+01  1.128e+01   -1.358 0.174529    \n   destCHO        -2.376e+01  1.223e+01   -1.943 0.052002 .  \n   destCHS        -1.137e+01  9.357e+00   -1.215 0.224251    \n   destCLE        -1.527e+01  1.107e+01   -1.379 0.167977    \n   destCLT        -1.335e+01  1.009e+01   -1.324 0.185488    \n   destCMH        -1.501e+01  1.060e+01   -1.415 0.157005    \n   destCRW        -1.786e+01  1.099e+01   -1.625 0.104185    \n   destCVG        -1.131e+01  9.788e+00   -1.155 0.247960    \n   destDAY        -1.258e+01  1.008e+01   -1.247 0.212338    \n   destDCA        -1.737e+01  1.265e+01   -1.373 0.169821    \n   destDEN         3.626e+00  1.993e+00    1.819 0.068874 .  \n   destDFW        -2.358e+00  3.627e+00   -0.650 0.515579    \n   destDSM        -6.783e+00  6.380e+00   -1.063 0.287667    \n   destDTW        -1.518e+01  1.042e+01   -1.457 0.145120    \n   destEGE         1.910e+00  1.822e+00    1.049 0.294395    \n   destEYW         9.056e+00  6.852e+00    1.322 0.186285    \n   destFLL        -5.542e+00  5.998e+00   -0.924 0.355495    \n   destGRR        -8.645e+00  9.539e+00   -0.906 0.364781    \n   destGSO        -1.514e+01  1.076e+01   -1.407 0.159500    \n   destGSP        -1.091e+01  9.621e+00   -1.134 0.256944    \n   destHDN         3.200e+00  5.069e+00    0.631 0.527869    \n   destHNL         5.411e+01  2.467e+01    2.193 0.028282 *  \n   destHOU         2.465e-01  3.351e+00    0.074 0.941347    \n   destIAD        -1.621e+01  1.255e+01   -1.291 0.196542    \n   destIAH         7.570e-01  3.433e+00    0.221 0.825465    \n   destILM        -2.469e+01  1.057e+01   -2.335 0.019558 *  \n   destIND        -1.108e+01  9.195e+00   -1.205 0.228031    \n   destJAC         1.470e+01  3.986e+00    3.688 0.000226 ***\n   destJAX        -8.925e+00  7.876e+00   -1.133 0.257133    \n   destLAS         1.086e+01  3.476e+00    3.125 0.001777 ** \n   destLAX         1.530e+01  5.183e+00    2.951 0.003166 ** \n   destLEX        -1.584e+01  1.950e+01   -0.812 0.416700    \n   destLGB         7.967e+00  5.172e+00    1.541 0.123429    \n   destMCI        -5.006e+00  5.757e+00   -0.869 0.384603    \n   destMCO        -8.198e+00  6.971e+00   -1.176 0.239599    \n   destMDW        -7.564e+00  8.693e+00   -0.870 0.384194    \n   destMEM        -6.614e+00  6.876e+00   -0.962 0.336108    \n   destMHT        -2.027e+01  1.263e+01   -1.604 0.108631    \n   destMIA        -7.165e+00  5.843e+00   -1.226 0.220140    \n   destMKE        -7.506e+00  8.588e+00   -0.874 0.382142    \n   destMSN        -8.057e+00  8.048e+00   -1.001 0.316772    \n   destMSP        -5.813e+00  6.404e+00   -0.908 0.363986    \n   destMSY        -5.472e+00  5.178e+00   -1.057 0.290646    \n   destMTJ        -4.017e+00  4.839e+00   -0.830 0.406511    \n   destMVY        -2.100e+01  1.304e+01   -1.610 0.107346    \n   destMYR        -2.132e+01  1.023e+01   -2.085 0.037107 *  \n   destOAK         1.128e+01  6.060e+00    1.862 0.062586 .  \n   destOKC         4.926e+00  4.109e+00    1.199 0.230668    \n   destOMA        -5.027e+00  5.467e+00   -0.920 0.357816    \n   destORD        -1.229e+01  8.629e+00   -1.425 0.154274    \n   destORF        -1.906e+01  1.205e+01   -1.582 0.113714    \n   destPBI        -5.907e+00  6.313e+00   -0.936 0.349436    \n   destPDX         1.161e+01  5.039e+00    2.304 0.021227 *  \n   destPHL        -1.631e+01  1.359e+01   -1.200 0.230145    \n   destPHX         7.569e+00  2.798e+00    2.705 0.006825 ** \n   destPIT        -1.687e+01  1.171e+01   -1.441 0.149669    \n   destPSE         4.781e+00  2.213e+00    2.160 0.030783 *  \n   destPSP         1.445e+01  6.159e+00    2.346 0.018990 *  \n   destPVD        -2.027e+01  1.301e+01   -1.558 0.119288    \n   destPWM        -1.808e+01  1.215e+01   -1.489 0.136620    \n   destRDU        -1.540e+01  1.099e+01   -1.401 0.161146    \n   destRIC        -1.582e+01  1.207e+01   -1.311 0.189923    \n   destROC        -1.852e+01  1.229e+01   -1.507 0.131770    \n   destRSW        -6.231e+00  5.973e+00   -1.043 0.296894    \n   destSAN         1.450e+01  4.964e+00    2.921 0.003487 ** \n   destSAT        -3.508e+00  2.318e+00   -1.513 0.130275    \n   destSAV        -9.081e+00  8.739e+00   -1.039 0.298778    \n   destSBN        -2.131e+01  1.103e+01   -1.932 0.053411 .  \n   destSDF        -9.534e+00  9.239e+00   -1.032 0.302139    \n   destSEA         1.232e+01  4.787e+00    2.573 0.010083 *  \n   destSFO         1.615e+01  6.027e+00    2.680 0.007357 ** \n   destSJC         1.397e+01  6.001e+00    2.328 0.019890 *  \n   destSJU         1.244e+00  2.102e+00    0.592 0.554024    \n   destSLC         7.722e+00  1.745e+00    4.425 9.66e-06 ***\n   destSMF         1.406e+01  5.652e+00    2.487 0.012883 *  \n   destSNA         8.917e+00  5.021e+00    1.776 0.075737 .  \n   destSRQ        -5.625e+00  6.245e+00   -0.901 0.367785    \n   destSTL        -6.565e+00  7.442e+00   -0.882 0.377687    \n   destSTT         2.561e+00  2.063e+00    1.241 0.214552    \n   destSYR        -2.048e+01  1.272e+01   -1.610 0.107413    \n   destTPA        -5.975e+00  6.507e+00   -0.918 0.358541    \n   destTUL         3.772e-01  4.924e+00    0.077 0.938933    \n   destTVC        -1.470e+01  9.411e+00   -1.562 0.118398    \n   destTYS        -9.649e+00  9.343e+00   -1.033 0.301743    \n   destXNA        -1.214e+00  5.475e+00   -0.222 0.824586    \n   distance       -1.591e-02  7.821e-03   -2.034 0.041942 *  \n   hour            3.006e-01  1.718e-01    1.749 0.080290 .  \n   temp           -5.671e-02  1.979e-03  -28.658  &lt; 2e-16 ***\n   humid           1.804e-02  2.299e-03    7.844 4.38e-15 ***\n   wind_dir       -5.945e-03  3.548e-04  -16.754  &lt; 2e-16 ***\n   wind_speed      1.713e-01  6.771e-03   25.304  &lt; 2e-16 ***\n   precip          2.979e+01  2.687e+00   11.088  &lt; 2e-16 ***\n   pressure       -1.551e-01  4.964e-03  -31.244  &lt; 2e-16 ***\n   visib          -6.071e-01  2.638e-02  -23.009  &lt; 2e-16 ***\n   ---\n   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n   \n   Residual standard error: 16.95 on 284416 degrees of freedom\n   Multiple R-squared:  0.8372, Adjusted R-squared:  0.8371 \n   F-statistic: 1.099e+04 on 133 and 284416 DF,  p-value: &lt; 2.2e-16\n\n\n\n\n\n\n\nQ4 减少变量之后拟合优度R2显著提升，原因是什么？\n\n\n\n现象：对于挑出的具有代表性的变量进行集合之后，发现调整后的R2值提高到0.83.一个很震惊的结果！！！！\n分析原因如下：\nR2值，也称为决定系数，是衡量线性回归模型拟合优度的重要指标。它表示模型解释的变异占总变异的比例，计算公式为R2=1-SSres/SStot，其中SSres是残差平方和，即实际观测值与模型预测值之差的平方和；SStot是总平方和，即实际观测值与观测值平均值之差的平方和。\n1.去除噪声：如果减少的变量是噪声变量（即与因变量关系不显著或无关的变量），那么去除这些变量可以减少模型中的噪声，提高模型的解释能力，进而使R2值变大。 2.自由度变化：在多元线性回归中，增加解释变量会减少模型的自由度。当减少变量时，自由度增加，这可能导致残差平方和（SSres）相对于总平方和（SStot）的比例减小，从而使R2值变大。但需要注意的是，这种变化并不总是显著的，因为R2值还受到其他因素的影响。",
    "crumbs": [
      "Linear Regression"
    ]
  },
  {
    "objectID": "EDA/weather.html",
    "href": "EDA/weather.html",
    "title": "weather dataset exploration",
    "section": "",
    "text": "&gt; library(nycflights13)\n&gt; library(tidyverse)\n\n\n&gt; flights\n   # A tibble: 336,776 × 19\n       year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time\n      &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;\n    1  2013     1     1      517            515         2      830            819\n    2  2013     1     1      533            529         4      850            830\n    3  2013     1     1      542            540         2      923            850\n    4  2013     1     1      544            545        -1     1004           1022\n    5  2013     1     1      554            600        -6      812            837\n    6  2013     1     1      554            558        -4      740            728\n    7  2013     1     1      555            600        -5      913            854\n    8  2013     1     1      557            600        -3      709            723\n    9  2013     1     1      557            600        -3      838            846\n   10  2013     1     1      558            600        -2      753            745\n   # ℹ 336,766 more rows\n   # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,\n   #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,\n   #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;\n&gt; weather\n   # A tibble: 26,115 × 15\n      origin  year month   day  hour  temp  dewp humid wind_dir wind_speed\n      &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;\n    1 EWR     2013     1     1     1  39.0  26.1  59.4      270      10.4 \n    2 EWR     2013     1     1     2  39.0  27.0  61.6      250       8.06\n    3 EWR     2013     1     1     3  39.0  28.0  64.4      240      11.5 \n    4 EWR     2013     1     1     4  39.9  28.0  62.2      250      12.7 \n    5 EWR     2013     1     1     5  39.0  28.0  64.4      260      12.7 \n    6 EWR     2013     1     1     6  37.9  28.0  67.2      240      11.5 \n    7 EWR     2013     1     1     7  39.0  28.0  64.4      240      15.0 \n    8 EWR     2013     1     1     8  39.9  28.0  62.2      250      10.4 \n    9 EWR     2013     1     1     9  39.9  28.0  62.2      260      15.0 \n   10 EWR     2013     1     1    10  41    28.0  59.6      260      13.8 \n   # ℹ 26,105 more rows\n   # ℹ 5 more variables: wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;,\n   #   visib &lt;dbl&gt;, time_hour &lt;dttm&gt;\n\norigin：天气观测站，命名为origin以便于与flights数据集进行合并。\nyear, month, day, hour：天气观测的时间，分别表示年、月、日和小时。\ntemp, dewp：温度和露点温度，以华氏度为单位。\nhumid：相对湿度。\nwind_dir, wind_speed!!, wind_gust：风向（以度为单位）、风速和阵风速度，以英里每小时为单位。\nprecip：降水量，以英寸为单位。\npressure：海平面气压，以毫巴为单位。\nvisib：能见度，以英里为单位。\ntime_hour：天气观测的日期和时间。",
    "crumbs": [
      "Exploratory Data Analysis",
      "weather dataset exploration"
    ]
  },
  {
    "objectID": "EDA/weather.html#q2-temp与dewp线性关系的验证",
    "href": "EDA/weather.html#q2-temp与dewp线性关系的验证",
    "title": "weather dataset exploration",
    "section": "Q2 temp与dewp线性关系的验证",
    "text": "Q2 temp与dewp线性关系的验证\n\n&gt; lm(data = weather,dewp~temp) |&gt;\n+   summary()\n   \n   Call:\n   lm(formula = dewp ~ temp, data = weather)\n   \n   Residuals:\n       Min      1Q  Median      3Q     Max \n   -38.805  -5.788   0.905   7.265  14.293 \n   \n   Coefficients:\n                 Estimate Std. Error t value Pr(&gt;|t|)    \n   (Intercept) -12.423754   0.175153  -70.93   &lt;2e-16 ***\n   temp          0.974726   0.003017  323.06   &lt;2e-16 ***\n   ---\n   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n   \n   Residual standard error: 8.673 on 26112 degrees of freedom\n     (1 observation deleted due to missingness)\n   Multiple R-squared:  0.7999, Adjusted R-squared:  0.7999 \n   F-statistic: 1.044e+05 on 1 and 26112 DF,  p-value: &lt; 2.2e-16\n\n使用线性回归进行验证，发现，temp可解释dewp80%的方差，且方程显著，证实了上述发现。目前，我们并不具备相关的物理知识，但统计学角度证实了二者的强相关关系。\n\n\n\n\n\n\n知识补充\n\n\n\n二者确实具有正相关的关系。当空气中水汽含量（绝对湿度）增加时，在相同的气压和气温条件下，水汽压也会随之升高。根据露点温度的定义，要使水汽达到饱和而凝结的温度（露点温度）也会升高。例如，在一个封闭的空间里，如果不断向其中增加水蒸气，空气就会越来越接近饱和状态，露点温度也会不断上升。",
    "crumbs": [
      "Exploratory Data Analysis",
      "weather dataset exploration"
    ]
  },
  {
    "objectID": "EDA/flights.html",
    "href": "EDA/flights.html",
    "title": "flights dataset exploration",
    "section": "",
    "text": "&gt; library(nycflights13)\n&gt; library(tidyverse)\n\n\n&gt; glimpse(flights)\n   Rows: 336,776\n   Columns: 19\n   $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…\n   $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n   $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n   $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …\n   $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …\n   $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…\n   $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…\n   $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…\n   $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…\n   $ carrier        &lt;chr&gt; \"UA\", \"UA\", \"AA\", \"B6\", \"DL\", \"UA\", \"B6\", \"EV\", \"B6\", \"…\n   $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…\n   $ tailnum        &lt;chr&gt; \"N14228\", \"N24211\", \"N619AA\", \"N804JB\", \"N668DN\", \"N394…\n   $ origin         &lt;chr&gt; \"EWR\", \"LGA\", \"JFK\", \"JFK\", \"LGA\", \"EWR\", \"EWR\", \"LGA\",…\n   $ dest           &lt;chr&gt; \"IAH\", \"IAH\", \"MIA\", \"BQN\", \"ATL\", \"ORD\", \"FLL\", \"IAD\",…\n   $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…\n   $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …\n   $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…\n   $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…\n   $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…\n\nyear, month, day：起飞日期，分别表示年、月、日。\ndep_time, arr_time：实际起飞时间和实际到达时间，以分钟为单位。\nsched_dep_time, sched_arr_time：计划起飞时间和计划到达时间，以分钟为单位。\nair_time：飞行时间，以分钟为单位。\ndistance：航班距离，以英里为单位。\ntime_hour：计划起飞日期和时间，作为POSIXct日期。\norigin：起飞机场，用于与weather数据集进行连接。",
    "crumbs": [
      "Exploratory Data Analysis",
      "flights dataset exploration"
    ]
  },
  {
    "objectID": "EDA/flights.html#柱状图",
    "href": "EDA/flights.html#柱状图",
    "title": "flights dataset exploration",
    "section": "柱状图",
    "text": "柱状图\n\n&gt; flights|&gt;\n+   ggplot(aes(x=carrier,y = arr_delay))+\n+   geom_bar(stat = 'identity',fill = 'steelblue')+\n+   theme_bw()\n\n\n\n\n\n\n\n\n我们发现，AS、F9、HA、OO、YV航班几乎都准时到达，但是B6、DL、EV、UA这些航班的到达时间差距较大，很不稳定。 跟上图对照着看，我们发现小型公司的延误更少，他们一年中的航班数虽然少，但是几乎都准时到达，而航班数较多的大型航空公司遇到的情况更多，延误可能性更大，延误时间不稳定。",
    "crumbs": [
      "Exploratory Data Analysis",
      "flights dataset exploration"
    ]
  },
  {
    "objectID": "EDA/flights.html#哑铃图",
    "href": "EDA/flights.html#哑铃图",
    "title": "flights dataset exploration",
    "section": "哑铃图",
    "text": "哑铃图\n\n&gt; library(ggalt)\n&gt; Arr &lt;- flights |&gt;\n+   na.omit() |&gt;\n+   group_by(carrier = as.factor(carrier)) |&gt;\n+   summarise(min = min(arr_delay), max=max(arr_delay))\n&gt; \n&gt; ggplot(Arr,aes(x= min, xend=max, y=carrier, group = carrier)) +\n+         geom_dumbbell(color=\"#a3c4dc\",\n+                       size=0.75,\n+                       colour_x =\"darkblue\",\n+                      colour_xend=\"red\",\n+                      size_x = 2,\n+               size_xend = 2) +\n+          labs(x=\"\",\n+          y=\"\",\n+        title=\"The span of arive delay at different carrier\")+\n+     theme_bw()+\n+     theme(plot.title = element_text(size=15)\n+      ,axis.text.x= element_text(size=10),\n+        axis.text.y= element_text(size=10),\n+         axis.title=element_text(size=10))\n\n\n\n\n\n\n\n\n航空公司与推迟时间的Dumbbell Chart(哑铃图)，采用的是最大延误时间与最小延误时间的差值（极差），大小反映在长度上。\n从图中可以看出，大多数航空公司都存在一定程度的到达延误情况。 YV 航空公司的延误跨度最长，该航空公司的到达延误时间变化范围很大。 9E、AA 等的延误跨度相对较短，这些航空公司的到达延误时间变化范围较小。",
    "crumbs": [
      "Exploratory Data Analysis",
      "flights dataset exploration"
    ]
  },
  {
    "objectID": "EDA/flights.html#q1-为什么哑铃图展现的信息与柱状图不一样",
    "href": "EDA/flights.html#q1-为什么哑铃图展现的信息与柱状图不一样",
    "title": "flights dataset exploration",
    "section": "Q1 为什么哑铃图展现的信息与柱状图不一样？",
    "text": "Q1 为什么哑铃图展现的信息与柱状图不一样？\n柱状图中，对于每个carrier（航空公司），arr_delay对应的是一个特定的值（可能是平均值、总和或者其他汇总值），而不是最大值和最小值。\n这里将哑铃图的两端点定义为最大值和最小值，来看，不同航班的延误情况。两张图可以结合着看，得到更准确的信息。",
    "crumbs": [
      "Exploratory Data Analysis",
      "flights dataset exploration"
    ]
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "机器学习模型构建",
    "section": "",
    "text": "在本章，尝试了多种机器学习方法，但由于数据量很大，但计算机资源有限，因此这里只展示了目前训练较好的模型和最好的参数选择。\n\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom sklearn.model_selection import train_test_split, GridSearchCV, cross_val_score\nfrom sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier\nfrom sklearn.metrics import cohen_kappa_score\nfrom sklearn.metrics import classification_report, accuracy_score\nfrom sklearn.metrics import confusion_matrix, accuracy_score, precision_score, recall_score, f1_score\nfrom sklearn.model_selection import StratifiedKFold\nfrom sklearn.preprocessing import OneHotEncoder\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\n\n\n载入数据\n\nCare_data = pd.read_excel(\"D:\\\\Rstudio\\\\Rmyfile\\\\dear Cancan.R\\\\select_data.xlsx\")\nprint(f\"Number of rows: {Care_data.shape[0]}, Number of columns: {Care_data.shape[1]}\")\nprint(Care_data)\nprint('数据载入完毕============================================1')\n\nNumber of rows: 284550, Number of columns: 19\n        month  day  sched_dep_time  dep_delay  sched_arr_time  arr_delay  \\\n0           1    1             515          2             819         11   \n1           1    1             529          4             830         20   \n2           1    1             540          2             850         33   \n3           1    1             545         -1            1022        -18   \n4           1    1             600         -6             837        -25   \n...       ...  ...             ...        ...             ...        ...   \n284545      9   30            2245         -5            2351        -17   \n284546      9   30            2250        -10               7        -20   \n284547      9   30            2246         -5               1        -16   \n284548      9   30            2255         12            2358          1   \n284549      9   30            2359        -10             350        -25   \n\n       carrier origin dest  distance  hour   temp   dewp  humid  wind_dir  \\\n0           UA    EWR  IAH      1400     5  39.02  28.04  64.43       260   \n1           UA    LGA  IAH      1416     5  39.92  24.98  54.81       250   \n2           AA    JFK  MIA      1089     5  39.02  26.96  61.63       260   \n3           B6    JFK  BQN      1576     5  39.02  26.96  61.63       260   \n4           DL    LGA  ATL       762     6  39.92  24.98  54.81       260   \n...        ...    ...  ...       ...   ...    ...    ...    ...       ...   \n284545      B6    JFK  SYR       209    22  60.98  55.94  83.47       230   \n284546      B6    JFK  BUF       301    22  60.98  55.94  83.47       230   \n284547      B6    JFK  ROC       264    22  60.98  55.94  83.47       230   \n284548      B6    JFK  BOS       187    22  60.98  55.94  83.47       230   \n284549      B6    JFK  PSE      1617    23  60.08  55.04  83.41       240   \n\n        wind_speed  precip  pressure  visib  \n0         12.65858     0.0    1011.9   10.0  \n1         14.96014     0.0    1011.4   10.0  \n2         14.96014     0.0    1012.1   10.0  \n3         14.96014     0.0    1012.1   10.0  \n4         16.11092     0.0    1011.7   10.0  \n...            ...     ...       ...    ...  \n284545     9.20624     0.0    1016.5   10.0  \n284546     9.20624     0.0    1016.5   10.0  \n284547     9.20624     0.0    1016.5   10.0  \n284548     9.20624     0.0    1016.5   10.0  \n284549     9.20624     0.0    1016.3   10.0  \n\n[284550 rows x 19 columns]\n数据载入完毕============================================1\n\n\n\n\n数据处理\n\nCare_data['result'] = Care_data['arr_delay'].apply(lambda x: 1 if x &gt; 0 else 0)\nprint('二分类变量添加完毕=========================================2')\n\n二分类变量添加完毕=========================================2\n\n\n\nplt.rcParams['font.sans-serif'] = ['SimHei']  # 设置默认字体为SimHei，支持中文显示\nplt.rcParams['axes.unicode_minus'] = False  # 解决保存图像时负号'-'显示为方块的问题\nsns.countplot(x='result', data=Care_data)\nplt.show()\nprint('变量分布图创建完毕=====================================3')\n\n\n\n\n\n\n\n\n变量分布图创建完毕=====================================3\n\n\n数据分布不太均衡，正常：延迟 约=5:3\n\ncategorical_features = ['month', 'day', 'hour','carrier', 'origin', 'dest']\ncategorical_transformer = OneHotEncoder(handle_unknown='ignore')\npreprocessor = ColumnTransformer(\n    transformers=[\n        ('cat', categorical_transformer, categorical_features)],\n    remainder='passthrough')  # 对于非分类特征，直接传递\nprint('独热编码进行完毕=======================================4')\n\n独热编码进行完毕=======================================4\n\n\n\n\n划分训练集和测试集\n以8:2的比例划分训练集和测试集\n\nX = Care_data.drop(columns=['result', 'arr_delay'])  # 假设'result'是目标变量的新名称，'arr_delay'用于生成'result'\nY = Care_data['result']\nnp.random.seed(1234)\nTrainX, TestX, TrainY, TestY = train_test_split(X, Y, test_size=0.2, random_state=42, stratify=Y)\nprint('训练集和测试集划分完毕==================================5')\nTrainX\n\n训练集和测试集划分完毕==================================5\n\n\n\n\n\n\n\n\n\nmonth\nday\nsched_dep_time\ndep_delay\nsched_arr_time\ncarrier\norigin\ndest\ndistance\nhour\ntemp\ndewp\nhumid\nwind_dir\nwind_speed\nprecip\npressure\nvisib\n\n\n\n\n58312\n11\n12\n1800\n-6\n2039\nDL\nLGA\nATL\n762\n18\n35.96\n17.06\n45.76\n330\n19.56326\n0.0\n1024.5\n10.0\n\n\n269753\n9\n13\n1725\n43\n2015\nUA\nEWR\nIAH\n1400\n17\n73.04\n51.98\n47.59\n330\n21.86482\n0.0\n1006.3\n10.0\n\n\n240867\n8\n8\n815\n-8\n930\nMQ\nJFK\nDCA\n213\n8\n71.96\n69.98\n93.49\n160\n10.35702\n0.0\n1018.6\n10.0\n\n\n130240\n3\n21\n824\n-4\n1014\nEV\nEWR\nRDU\n416\n8\n32.00\n15.98\n51.15\n350\n12.65858\n0.0\n1008.4\n10.0\n\n\n224635\n7\n19\n1454\n9\n1710\nEV\nLGA\nCLT\n544\n14\n98.06\n69.98\n40.44\n220\n13.80936\n0.0\n1010.6\n10.0\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n65739\n11\n21\n910\n24\n1130\nEV\nLGA\nCLT\n544\n9\n42.98\n28.04\n55.27\n50\n10.35702\n0.0\n1036.3\n10.0\n\n\n116683\n3\n3\n956\n-7\n1240\nB6\nJFK\nLAS\n2248\n9\n33.08\n15.98\n48.98\n330\n13.80936\n0.0\n1007.0\n10.0\n\n\n106675\n2\n18\n1204\n-2\n1426\nUA\nEWR\nDEN\n1605\n12\n33.08\n3.02\n27.40\n290\n20.71404\n0.0\n1023.5\n10.0\n\n\n249943\n8\n19\n1520\n-6\n1705\nAA\nLGA\nSTL\n888\n15\n80.06\n59.00\n48.64\n230\n11.50780\n0.0\n1017.0\n10.0\n\n\n64229\n11\n19\n1659\n-8\n2034\nB6\nJFK\nOAK\n2576\n16\n44.06\n23.00\n43.02\n340\n17.26170\n0.0\n1021.0\n10.0\n\n\n\n\n227640 rows × 18 columns\n\n\n\n\n\n5折交叉验证\n5折交叉验证的原理是将训练数据划分成5份，训练5次，每次用其中一份作为测试集，其余4份作为训练集。通过多次训练取平均来避免模型的过度拟合，提升模型的泛化能力。\n\ncv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n\n\n\n在测试机表现评价函数\n\ndef myconfusionmatrix(TestY, y_pred):\n    # 混淆矩阵\n    cm = confusion_matrix(TestY, y_pred)\n    # Kappa值\n    kappa = cohen_kappa_score(TestY, y_pred)\n    # 计算准确率\n    accuracy = accuracy_score(TestY, y_pred)\n    # 计算精确率（对于多分类问题，需要指定平均方法，如'macro', 'micro', 'weighted'）\n    precision = precision_score(TestY, y_pred, average='macro')  # 或者使用'micro', 'weighted'等\n    # 计算召回率\n    recall = recall_score(TestY, y_pred, average='macro')  # 同样需要指定平均方法\n    # 计算F1分数\n    f1 = f1_score(TestY, y_pred, average='weighted')  # 同样需要指定平均方法\n    return (cm, accuracy, precision, recall, f1, kappa)\n\n\n\n随机森林模型构建\n\npipeline = Pipeline(steps=[('preprocessor', preprocessor),\n                           ('classifier', RandomForestClassifier(random_state=42, n_estimators=100))])\nparam_grid = {\n    'classifier__n_estimators': [300],\n    'classifier__max_features': ['sqrt'],\n    'classifier__max_depth': [10],\n    'classifier__criterion': ['gini']\n}\n\n\ngrid_search = GridSearchCV(pipeline, param_grid, cv=cv, scoring='accuracy', n_jobs=-1, verbose=1)\ngrid_search.fit(TrainX, TrainY)\nprint(\"Best parameters for RandomForest:\", grid_search.best_params_)\nprint(\"Best cross-validation score for RandomForest:\", grid_search.best_score_)\n\nFitting 5 folds for each of 1 candidates, totalling 5 fits\nBest parameters for RandomForest: {'classifier__criterion': 'gini', 'classifier__max_depth': 10, 'classifier__max_features': 'sqrt', 'classifier__n_estimators': 300}\nBest cross-validation score for RandomForest: 0.8004085397996837\n\n\n该模型的综合评分为0.80。\n\n\n测试集上的表现\n\nbest_rf = grid_search.best_estimator_\ny_pred = best_rf.predict(TestX)\nlist2 = myconfusionmatrix(TestY, y_pred)\nconfusion_matrix = list2[0]\naccuracy = list2[1]\nprecision = list2[2]\nrecall = list2[3]\nf1_score = list2[4]\nKappa = list2[5]\nprint('输出混淆矩阵========================================7')\nprint(f\"Confusion Matrix:\\n{confusion_matrix}\\nKappa:{Kappa}\\nAccuracy: {accuracy}\\nPrecision: {precision}\\nRecall: {recall}\\nF1 Score: {f1_score}\")\n\n输出混淆矩阵========================================7\nConfusion Matrix:\n[[33383  1516]\n [ 9906 12105]]\nKappa:0.5448613656932183\nAccuracy: 0.7992971358285011\nPrecision: 0.8299335775977371\nRecall: 0.7532563282373411\nF1 Score: 0.7864363936594723\n\n\n混淆矩阵：正类是延迟，负类是正常\n真正例（True Positive，TP）：这里是 12105，表示实际航班延迟，并且模型也正确预测为延迟抵达的样本数量。 假正例（False Positive，FP）：位于矩阵右上角的值，即 1516，代表实际属于正常抵达，但模型错误地预测为延迟的样本数量。 假负例（False Negative，FN）：在矩阵左下角，值为 9906，意味着实际属于延迟，然而模型却预测为正常抵达的样本数量。 真负例（True Negative，TN）：位于矩阵左上角，也就是 33383，是实际为正常且模型也正确预测为正常抵达的样本数量。\n即：实际正常抵达的航班中有1516个预测错误；实际延迟抵达的航班中有9906个预测错误，在正类的预测中准确率不太高。\nKappa 值 0.5448613656932183，说明模型的分类结果相较于随机分类有一定程度的一致性，但还存在改进的空间。\n\n\n\n\n\n\nKappa值的判定标准\n\n\n\n用于衡量分类任务中两个观察者（或模型预测与真实标签）之间一致性的统计指标。\n0.00~0.20：极低的一致性（slight），表示评估结果或模型预测与实际标签之间的一致性很差，可能存在较大的差异。\n0.21~0.40：较低的一致性（fair），表示有一定的一致性，但整体仍然偏低。\n0.41~0.60：中等的一致性（moderate），表示评估结果或模型预测与实际标签之间的一致性较为适中。\n0.61~0.80：较高的一致性（substantial），表示评估结果或模型预测与实际标签之间的一致性较高。\n0.81~1.00：高一致性（almost perfect），表示评估结果或模型预测与实际标签之间的一致性几乎完全一致。\n\n\n准确率 为 0.7992971358285011，意味着模型总体上能正确分类大约 80% 的样本，但这个指标可能会在样本不平衡的情况下有一定误导性，比如正负样本数量差异很大时，准确率高不一定代表模型对少数类的分类能力强。\n精确率 为 0.8299335775977371，表明当模型预测某个样本为正类时，有大约 83% 的概率是预测正确的。\n召回率 0.7532563282373411，意味着在所有实际的正类样本里，模型能够正确找出来的比例约为 75%，反映了模型对正类样本的覆盖能力。\nF1 分数 为 0.7864363936594723，代表模型在精确率和召回率上整体达到了一定的平衡水平，不过同样还有一定的提升空间。\n\n\nROC曲线绘制\n\nfrom sklearn.metrics import roc_curve, auc\n\n\n\n提取概率值\n\nrf_pred_prob = best_rf.predict_proba(TestX)[:, 1] \n\n\n\n计算AUC值\n\nfpr1, tpr1, thresholds1 = roc_curve(TestY, rf_pred_prob)  \nauc1 = auc(fpr1, tpr1) \n\n\n\n绘制ROC曲线\n\nplt.figure()  \nplt.plot(fpr1, tpr1, color='red', lw=2, label=f'Random Forest (AUC = {auc1:.2f})')  \nplt.plot([0, 1], [0, 1], color='black', lw=2, linestyle='--')  \nplt.xlim([0.0, 1.0])  \nplt.ylim([0.0, 1.05])  \nplt.xlabel('False Positive Rate')  \nplt.ylabel('True Positive Rate')  \nplt.title('Receiver Operating Characteristic (ROC) Curves')  \nplt.legend(loc=\"lower right\")  \nplt.show()\n\n\n\n\n\n\n\n\n该模型的AUC值为0.84，模型训练各指标可以接受，但还有待提升。",
    "crumbs": [
      "Machine Learning"
    ]
  },
  {
    "objectID": "EDA/joined_data.html",
    "href": "EDA/joined_data.html",
    "title": "join two datasets",
    "section": "",
    "text": "联立两个数据集\n经过对两个数据集的探索，我们大致了解了变量之间的关系，接下来，为了实现同时构建线性模型，我们需要将两个数据集进行整合。\n\n&gt; # 加载必要的包\n&gt; library(dplyr)\n&gt; library(nycflights13)\n&gt; \n&gt; # 加载数据集\n&gt; flights_data &lt;- flights\n&gt; weather_data &lt;- weather\n&gt; \n&gt; # 使用 inner_join 进行联立\n&gt; joined_data &lt;- inner_join(flights_data, weather_data, by = c(\"origin\",\"year\",\"month\",\"day\",\"hour\"))\n&gt; \n&gt; # 查看联立后的数据\n&gt; joined_data\n   # A tibble: 335,220 × 29\n       year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time\n      &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;\n    1  2013     1     1      517            515         2      830            819\n    2  2013     1     1      533            529         4      850            830\n    3  2013     1     1      542            540         2      923            850\n    4  2013     1     1      544            545        -1     1004           1022\n    5  2013     1     1      554            600        -6      812            837\n    6  2013     1     1      554            558        -4      740            728\n    7  2013     1     1      555            600        -5      913            854\n    8  2013     1     1      557            600        -3      709            723\n    9  2013     1     1      557            600        -3      838            846\n   10  2013     1     1      558            600        -2      753            745\n   # ℹ 335,210 more rows\n   # ℹ 21 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,\n   #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,\n   #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour.x &lt;dttm&gt;, temp &lt;dbl&gt;, dewp &lt;dbl&gt;,\n   #   humid &lt;dbl&gt;, wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;,\n   #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour.y &lt;dttm&gt;\n\n\n\n\n\n\n\nQ3 为什么联立后的数据变少了？\n\n\n\n发现，联立后的数据样本信息比flights原始数据集少一千多条，接下来，探究其原因\n\n\n（此处借用一下老师的查找缺失值的函数）\n\n&gt; library(YangPac)\n&gt; Missing(flights)\n\n\n\n\n\n\n\n&gt; Missing(weather)\n\n\n\n\n\n\n\n\n首先对缺失值进行检验，发现，我们的联立变量在两个数据集中均没有缺失。接着，考虑时间维度。\n\n&gt; #联立后数据\n&gt; A  &lt;- joined_data |&gt;\n+   arrange(year,month,day,hour)\n&gt; A[335220,]\n   # A tibble: 1 × 29\n      year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time\n     &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;\n   1  2013    12    30     2141           1815       206        2           2041\n   # ℹ 21 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,\n   #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,\n   #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour.x &lt;dttm&gt;, temp &lt;dbl&gt;, dewp &lt;dbl&gt;,\n   #   humid &lt;dbl&gt;, wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;,\n   #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour.y &lt;dttm&gt;\n&gt; # flights数据集\n&gt; B&lt;- flights|&gt;\n+   arrange(year,month,day,hour)\n&gt; B[336776,]\n   # A tibble: 1 × 19\n      year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time\n     &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;\n   1  2013    12    31     2356           2359        -3      436            445\n   # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,\n   #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,\n   #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;\n&gt; # 天气数据集\n&gt; C &lt;- weather|&gt;\n+   arrange(year,month,day,hour)\n&gt; C[26115,]\n   # A tibble: 1 × 15\n     origin  year month   day  hour  temp  dewp humid wind_dir wind_speed wind_gust\n     &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;\n   1 LGA     2013    12    30    18  28.9  10.9  46.4      330       18.4        NA\n   # ℹ 4 more variables: precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;,\n   #   time_hour &lt;dttm&gt;\n\n通过对各个数据集按时间排序后，调出最后一条数据，进行比较，发现，天气数据集中仅仅到12月30日18时，而18时之后以及31日的天气数据没有包含在天气数据集中，而flights数据集中有一千多条数据在这部分时间。由于这一天的一千多条的数据缺失对我们33万多条数据来说影响不大，因此不做考虑。\n首先浏览一下我们的数据集。\n\n&gt; glimpse(joined_data)\n   Rows: 335,220\n   Columns: 29\n   $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…\n   $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n   $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n   $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …\n   $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …\n   $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…\n   $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…\n   $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…\n   $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…\n   $ carrier        &lt;chr&gt; \"UA\", \"UA\", \"AA\", \"B6\", \"DL\", \"UA\", \"B6\", \"EV\", \"B6\", \"…\n   $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…\n   $ tailnum        &lt;chr&gt; \"N14228\", \"N24211\", \"N619AA\", \"N804JB\", \"N668DN\", \"N394…\n   $ origin         &lt;chr&gt; \"EWR\", \"LGA\", \"JFK\", \"JFK\", \"LGA\", \"EWR\", \"EWR\", \"LGA\",…\n   $ dest           &lt;chr&gt; \"IAH\", \"IAH\", \"MIA\", \"BQN\", \"ATL\", \"ORD\", \"FLL\", \"IAD\",…\n   $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…\n   $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …\n   $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…\n   $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…\n   $ time_hour.x    &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…\n   $ temp           &lt;dbl&gt; 39.02, 39.92, 39.02, 39.02, 39.92, 39.02, 37.94, 39.92,…\n   $ dewp           &lt;dbl&gt; 28.04, 24.98, 26.96, 26.96, 24.98, 28.04, 28.04, 24.98,…\n   $ humid          &lt;dbl&gt; 64.43, 54.81, 61.63, 61.63, 54.81, 64.43, 67.21, 54.81,…\n   $ wind_dir       &lt;dbl&gt; 260, 250, 260, 260, 260, 260, 240, 260, 260, 260, 260, …\n   $ wind_speed     &lt;dbl&gt; 12.65858, 14.96014, 14.96014, 14.96014, 16.11092, 12.65…\n   $ wind_gust      &lt;dbl&gt; NA, 21.86482, NA, NA, 23.01560, NA, NA, 23.01560, NA, 2…\n   $ precip         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n   $ pressure       &lt;dbl&gt; 1011.9, 1011.4, 1012.1, 1012.1, 1011.7, 1011.9, 1012.4,…\n   $ visib          &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,…\n   $ time_hour.y    &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…\n\n\n\n对于缺失值的处理\n\n&gt; Missing(joined_data)\n\n\n\n\n\n\n\n\n发现缺失值较多，多集中在wind_gust这个变量上，因此删除，并删除剩下数据集中包含缺失值的行。\n\n&gt; joined_data &lt;- na.omit(joined_data[,-25])\n&gt; Missing(joined_data)\n\n\n\n\n\n\n\n\n\n&gt; library(writexl)\n&gt; write_xlsx(joined_data, \"joined_data.xlsx\")",
    "crumbs": [
      "Exploratory Data Analysis",
      "join two datasets"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Let us to explore the flights datasets",
    "section": "",
    "text": "This is a website created by Wencan Yang.\nThis is an English-Chinese mixed website. On this website, I present my analysis related to flight delays in the Flights dataset.\nFirstly, I conducted an initial exploratory data analysis on the flights dataset and the weather dataset in the nycflights13 package to understand the relationships among various variables.\nThen, I combined the two datasets and performed certain preprocessing on the combined data to make the dataset complete and clean.\nAfter that, I constructed a full model and a selected model using the general linear model method.\nFinally, taking arr_delay = 0 as the critical point, flights with a value greater than 0 are regarded as delayed, and those less than 0 are considered to arrive on time. Based on this rule, the continuous target variable is transformed into a binary variable.\nSubsequently, a machine learning model is constructed for prediction on the basis of 5-fold cross-validation. The accuracy reaches 0.8, but there is still room for improvement.\n\n\n\n\n\n\n思路简介\n\n\n\n\n首先我对于nycflights13包中的flights数据集和weather数据集做了初步的数据探索性分析了解各变量之间的关系。\n将两个数据集联立，对联立后的数据做一定的预处理，使得数据集完整，干净。\n使用一般线性模型的方法构建全模型和选模型，R2值达到0.83。\n之后由临界点arr_delay=0为临界点，大于0视为延迟，小于0为正常抵达。以这个规则将连续型的目标变量划转化成二分类的变量。\n在使用5折交叉验证的基础上构建机器学习模型进行预测。精确程度达到0.8，但仍有提升的空间。",
    "crumbs": [
      "Welcome"
    ]
  }
]